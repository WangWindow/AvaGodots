<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AvaGodots.ViewModels.Pages"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="580"
             x:Class="AvaGodots.Views.Pages.SettingsPage"
             x:DataType="vm:SettingsPageViewModel">

  <Design.DataContext>
    <vm:SettingsPageViewModel/>
  </Design.DataContext>

  <Grid ColumnDefinitions="220,*">

    <!-- ========== 左侧分类导航 ========== -->
    <Border Grid.Column="0" Background="{DynamicResource DarkColor2}"
            BorderBrush="{DynamicResource SeparatorBrush}" BorderThickness="0,0,1,0">
      <DockPanel>
        <!-- 底部 Settings Folder 按钮 -->
        <Button DockPanel.Dock="Bottom" Classes="action" Margin="8"
                HorizontalAlignment="Stretch" Command="{Binding OpenConfigDirectoryCommand}">
          <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
            <PathIcon Data="{StaticResource folder_regular}" Width="14" Height="14"/>
            <TextBlock Text="{DynamicResource Settings.Folder}"/>
          </StackPanel>
        </Button>

        <!-- 分类树 -->
        <ScrollViewer Padding="4,8">
          <StackPanel Spacing="2">

            <!-- Application 标题 -->
            <TextBlock Text="{DynamicResource Settings.Nav.Application}" FontWeight="Bold" FontSize="13"
                       Foreground="{DynamicResource FontDimBrush}"
                       Margin="12,8,0,4"/>

            <Button Classes="settingsNavItem" Classes.selected="{Binding IsConfigVisible}"
                    Command="{Binding SelectCategoryCommand}" CommandParameter="0">
              <TextBlock Text="{DynamicResource Settings.Nav.Config}"/>
            </Button>
            <Button Classes="settingsNavItem" Classes.selected="{Binding IsThemeVisible}"
                    Command="{Binding SelectCategoryCommand}" CommandParameter="1">
              <TextBlock Text="{DynamicResource Settings.Nav.Theme}"/>
            </Button>
            <Button Classes="settingsNavItem" Classes.selected="{Binding IsAdvancedVisible}"
                    Command="{Binding SelectCategoryCommand}" CommandParameter="2">
              <TextBlock Text="{DynamicResource Settings.Nav.Advanced}"/>
            </Button>

            <!-- Network 标题 -->
            <TextBlock Text="{DynamicResource Settings.Nav.Network}" FontWeight="Bold" FontSize="13"
                       Foreground="{DynamicResource FontDimBrush}"
                       Margin="12,16,0,4"/>

            <Button Classes="settingsNavItem" Classes.selected="{Binding IsProxyVisible}"
                    Command="{Binding SelectCategoryCommand}" CommandParameter="3">
              <TextBlock Text="{DynamicResource Settings.Nav.HttpProxy}"/>
            </Button>

          </StackPanel>
        </ScrollViewer>
      </DockPanel>
    </Border>

    <!-- ========== 右侧内容区域 ========== -->
    <DockPanel Grid.Column="1" Background="{DynamicResource DarkColor3}">

      <!-- 底部操作栏 -->
      <Border DockPanel.Dock="Bottom" Background="{DynamicResource DarkColor2}"
              BorderBrush="{DynamicResource SeparatorBrush}" BorderThickness="0,1,0,0"
              Padding="12,8" IsVisible="{Binding !NeedsRestart}">
        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
          <Button Classes="action" Command="{Binding ResetAllToDefaultCommand}">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <PathIcon Data="{StaticResource arrow_right_circle_regular}" Width="14" Height="14"/>
              <TextBlock Text="{DynamicResource Settings.ResetAll}"/>
            </StackPanel>
          </Button>
          <Button Classes="accent" Command="{Binding SaveAndCloseCommand}">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <PathIcon Data="{StaticResource checkmark_regular}" Width="14" Height="14"/>
              <TextBlock Text="{DynamicResource Settings.SaveAndClose}"/>
            </StackPanel>
          </Button>
        </StackPanel>
      </Border>

      <!-- 底部重启提示栏 -->
      <Border DockPanel.Dock="Bottom" Background="{DynamicResource DarkColor2}"
              BorderBrush="{DynamicResource WarningBrush}" BorderThickness="0,1,0,0"
              Padding="12,8"
              IsVisible="{Binding NeedsRestart}">
        <DockPanel>
          <Button DockPanel.Dock="Right" Classes="accent" Margin="8,0,0,0"
                  Command="{Binding SaveAndRestartCommand}">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <PathIcon Data="{StaticResource arrow_sync_regular}" Width="14" Height="14"/>
              <TextBlock Text="{DynamicResource Settings.SaveAndRestart}"/>
            </StackPanel>
          </Button>
          <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
            <PathIcon Data="{StaticResource warning_regular}" Width="16" Height="16"
                      Foreground="{DynamicResource WarningBrush}"/>
            <TextBlock Text="{DynamicResource Settings.NeedsRestart}"
                       Foreground="{DynamicResource WarningBrush}" FontSize="13"/>
          </StackPanel>
        </DockPanel>
      </Border>

      <!-- 设置面板内容 -->
      <ScrollViewer Padding="24,18">
        <Panel>

          <!-- ===== Application > Config ===== -->
          <StackPanel Spacing="16" IsVisible="{Binding IsConfigVisible}">
            <TextBlock Text="{DynamicResource Settings.Config.Title}" Classes="title" Margin="0,0,0,8"/>

            <!-- Language -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Config.Language}" VerticalAlignment="Center" Opacity="0.6"/>
              <ComboBox Grid.Column="1" Classes="sortCombo" HorizontalAlignment="Stretch"
                        ItemsSource="{Binding LanguageOptions}"
                        SelectedItem="{Binding Language}"/>
            </Grid>

            <!-- Auto Close -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Config.AutoClose}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding AutoClose}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- Scale -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Config.Scale}" VerticalAlignment="Center" Opacity="0.6"/>
              <ComboBox Grid.Column="1" Classes="sortCombo" HorizontalAlignment="Stretch"
                        ItemsSource="{Binding ScaleOptions}"
                        SelectedItem="{Binding Scale}"/>
            </Grid>

            <!-- Default Projects Path -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Config.DefaultProjectsPath}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                <TextBox Text="{Binding DefaultProjectsPath}" Classes="searchBox" IsReadOnly="True"/>
                <Button Grid.Column="1" Classes="iconAction" Margin="4,0,0,0"
                        Command="{Binding BrowseDefaultProjectsPathCommand}" ToolTip.Tip="{DynamicResource Common.Browse}">
                  <PathIcon Data="{StaticResource folder_open_regular}" Width="16" Height="16"/>
                </Button>
              </Grid>
            </Grid>

            <!-- Directory Naming Convention -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Config.DirNaming}" VerticalAlignment="Center" Opacity="0.6"/>
              <ComboBox Grid.Column="1" Classes="sortCombo" HorizontalAlignment="Stretch"
                        ItemsSource="{Binding NamingConventionOptions}"
                        SelectedItem="{Binding DirectoryNamingConvention}"/>
            </Grid>

            <!-- Use System Titlebar -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Config.SystemTitlebar}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding UseSystemTitleBar}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- Use Native File Dialog -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Config.NativeFileDialog}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding UseNativeFileDialog}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- Remember Window Rect -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Config.RememberWindowRect}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding RememberWindowSize}"
                            OnContent="" OffContent=""/>
            </Grid>
          </StackPanel>

          <!-- ===== Application > Theme ===== -->
          <StackPanel Spacing="16" IsVisible="{Binding IsThemeVisible}">
            <TextBlock Text="{DynamicResource Settings.Theme.Title}" Classes="title" Margin="0,0,0,8"/>

            <!-- Preset -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Theme.Preset}" VerticalAlignment="Center" Opacity="0.6"/>
              <ComboBox Grid.Column="1" Classes="sortCombo" HorizontalAlignment="Stretch"
                        ItemsSource="{Binding ThemePresetOptions}"
                        SelectedItem="{Binding ThemePreset}"/>
            </Grid>

            <!-- Base Color -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Theme.BaseColor}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="Auto,*" HorizontalAlignment="Stretch">
                <Border Width="28" Height="28" CornerRadius="4" Margin="0,0,8,0"
                        Background="{Binding BaseColor}"/>
                <TextBox Grid.Column="1" Classes="searchBox" Text="{Binding BaseColor}"/>
              </Grid>
            </Grid>

            <!-- Accent Color -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Theme.AccentColor}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="Auto,*" HorizontalAlignment="Stretch">
                <Border Width="28" Height="28" CornerRadius="4" Margin="0,0,8,0"
                        Background="{Binding AccentColor}"/>
                <TextBox Grid.Column="1" Classes="searchBox" Text="{Binding AccentColor}"/>
              </Grid>
            </Grid>

            <!-- Contrast -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Theme.Contrast}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="Auto,*" HorizontalAlignment="Stretch">
                <TextBlock Text="{Binding Contrast, StringFormat={}{0:F1}}"
                           Width="36" VerticalAlignment="Center" HorizontalAlignment="Center"
                           FontSize="12"/>
                <Slider Grid.Column="1" Minimum="-1" Maximum="1"
                        TickFrequency="0.1" IsSnapToTickEnabled="True"
                        Value="{Binding Contrast}"/>
              </Grid>
            </Grid>
          </StackPanel>

          <!-- ===== Application > Advanced ===== -->
          <StackPanel Spacing="16" IsVisible="{Binding IsAdvancedVisible}">
            <TextBlock Text="{DynamicResource Settings.Advanced.Title}" Classes="title" Margin="0,0,0,8"/>

            <!-- Downloads Path -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Advanced.DownloadsPath}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                <TextBox Text="{Binding DownloadsPath}" Classes="searchBox" IsReadOnly="True"/>
                <Button Grid.Column="1" Classes="iconAction" Margin="4,0,0,0"
                        Command="{Binding BrowseDownloadsPathCommand}" ToolTip.Tip="{DynamicResource Common.Browse}">
                  <PathIcon Data="{StaticResource folder_open_regular}" Width="16" Height="16"/>
                </Button>
              </Grid>
            </Grid>

            <!-- Versions Path -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Advanced.VersionsPath}" VerticalAlignment="Center" Opacity="0.6"/>
              <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                <TextBox Text="{Binding VersionsPath}" Classes="searchBox" IsReadOnly="True"/>
                <Button Grid.Column="1" Classes="iconAction" Margin="4,0,0,0"
                        Command="{Binding BrowseVersionsPathCommand}" ToolTip.Tip="{DynamicResource Common.Browse}">
                  <PathIcon Data="{StaticResource folder_open_regular}" Width="16" Height="16"/>
                </Button>
              </Grid>
            </Grid>

            <!-- Show Orphan Editor Explorer -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Advanced.OrphanExplorer}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding ShowOrphanEditorExplorer}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- Allow Install To Not Empty Dir -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Advanced.AllowNonEmpty}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding AllowInstallToNotEmptyDir}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- Check Only Stable Updates -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Advanced.StableOnly}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding OnlyStableUpdates}"
                            OnContent="" OffContent=""/>
            </Grid>

            <!-- VS Code Integration -->
            <Grid ColumnDefinitions="220,Auto">
              <TextBlock Text="{DynamicResource Settings.Advanced.VsCodeIntegration}" VerticalAlignment="Center" Opacity="0.6"/>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding EnableVsCodeIntegration}"
                            OnContent="" OffContent=""/>
            </Grid>
          </StackPanel>

          <!-- ===== Network > Http Proxy ===== -->
          <StackPanel Spacing="16" IsVisible="{Binding IsProxyVisible}">
            <TextBlock Text="{DynamicResource Settings.Proxy.Title}" Classes="title" Margin="0,0,0,8"/>

            <!-- Host -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Proxy.Host}" VerticalAlignment="Center" Opacity="0.6"/>
              <TextBox Grid.Column="1" Classes="searchBox" Text="{Binding ProxyHost}"
                       PlaceholderText="{DynamicResource Settings.Proxy.HostWatermark}"/>
            </Grid>

            <!-- Port -->
            <Grid ColumnDefinitions="220,*">
              <TextBlock Text="{DynamicResource Settings.Proxy.Port}" VerticalAlignment="Center" Opacity="0.6"/>
              <NumericUpDown Grid.Column="1" Minimum="0" Maximum="65535"
                             Value="{Binding ProxyPort}" FormatString="0"
                             HorizontalAlignment="Stretch"/>
            </Grid>
          </StackPanel>
        </Panel>
      </ScrollViewer>
    </DockPanel>
  </Grid>
</UserControl>
