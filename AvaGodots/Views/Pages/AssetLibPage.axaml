<!--
资源库页面 — 对应 godots 的 AssetLib 标签页
功能：搜索Godot资源库模板/项目/示例、筛选版本/分类/排序、网格卡片展示、分页
-->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AvaGodots.ViewModels.Pages"
             xmlns:models="using:AvaGodots.Models"
             xmlns:ic="using:FluentIcons.Avalonia"
             mc:Ignorable="d"
             x:Class="AvaGodots.Views.Pages.AssetLibPage"
             x:DataType="vm:AssetLibPageViewModel">

  <DockPanel Margin="8">

    <!-- ========== 顶部：搜索栏 ========== -->
    <Border DockPanel.Dock="Top" Margin="0,0,0,4">
      <TextBox Classes="searchBox" Watermark="Search Templates, Projects, and Demos"
               Text="{Binding SearchText}"/>
    </Border>

    <!-- ========== 筛选栏 ========== -->
    <Border DockPanel.Dock="Top" Margin="0,0,0,8">
      <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,*" HorizontalAlignment="Stretch">
        <!-- Version -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4" Margin="0,0,12,0">
          <TextBlock Text="Version:" VerticalAlignment="Center" FontSize="12"
                     Foreground="{DynamicResource FontDimBrush}"/>
          <ComboBox Classes="sortCombo" MinWidth="80"
                    ItemsSource="{Binding VersionOptions}"
                    SelectedItem="{Binding SelectedVersion}"/>
        </StackPanel>

        <!-- Sort -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" Margin="0,0,12,0">
          <TextBlock Text="Sort:" VerticalAlignment="Center" FontSize="12"
                     Foreground="{DynamicResource FontDimBrush}"/>
          <ComboBox Classes="sortCombo" MinWidth="150"
                    ItemsSource="{Binding SortOptions}"
                    SelectedItem="{Binding SelectedSort}"/>
        </StackPanel>

        <!-- Category -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" Margin="0,0,12,0">
          <TextBlock Text="Category:" VerticalAlignment="Center" FontSize="12"
                     Foreground="{DynamicResource FontDimBrush}"/>
          <ComboBox Classes="sortCombo" MinWidth="100"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategory}"/>
        </StackPanel>

        <!-- Site -->
        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" Margin="0,0,12,0">
          <TextBlock Text="Site:" VerticalAlignment="Center" FontSize="12"
                     Foreground="{DynamicResource FontDimBrush}"/>
          <ComboBox Classes="sortCombo" MinWidth="180"
                    ItemsSource="{Binding SiteOptions}"
                    SelectedItem="{Binding SelectedSite}"/>
        </StackPanel>

        <!-- Support (placeholder) -->
        <Button Grid.Column="4" Classes="action" Content="Support" VerticalAlignment="Center"/>
      </Grid>
    </Border>

    <!-- ========== 顶部分页 ========== -->
    <Border DockPanel.Dock="Top" Margin="0,0,0,8"
            IsVisible="{Binding TotalPages}">
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
        <Button Classes="action" Content="First" Command="{Binding FirstPageCommand}" Padding="8,4"/>
        <Button Classes="action" Content="Previous" Command="{Binding PreviousPageCommand}" Padding="8,4"/>

        <ItemsControl ItemsSource="{Binding PageNumbers}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" Spacing="2"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Button Classes="action" Padding="8,4" MinWidth="32"
                      HorizontalContentAlignment="Center">
                <Button.Content>
                  <TextBlock Text="{Binding, StringFormat={}{0}}"/>
                </Button.Content>
              </Button>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <Button Classes="action" Content="Next" Command="{Binding NextPageCommand}" Padding="8,4"/>
        <Button Classes="action" Content="Last" Command="{Binding LastPageCommand}" Padding="8,4"/>
      </StackPanel>
    </Border>

    <!-- ========== 底部分页（同上） ========== -->
    <Border DockPanel.Dock="Bottom" Margin="0,8,0,0"
            IsVisible="{Binding TotalPages}">
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
        <Button Classes="action" Content="First" Command="{Binding FirstPageCommand}" Padding="8,4"/>
        <Button Classes="action" Content="Previous" Command="{Binding PreviousPageCommand}" Padding="8,4"/>

        <ItemsControl ItemsSource="{Binding PageNumbers}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" Spacing="2"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Button Classes="action" Padding="8,4" MinWidth="32"
                      HorizontalContentAlignment="Center">
                <Button.Content>
                  <TextBlock Text="{Binding, StringFormat={}{0}}"/>
                </Button.Content>
              </Button>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <Button Classes="action" Content="Next" Command="{Binding NextPageCommand}" Padding="8,4"/>
        <Button Classes="action" Content="Last" Command="{Binding LastPageCommand}" Padding="8,4"/>
      </StackPanel>
    </Border>

    <!-- ========== 加载状态 ========== -->
    <Panel IsVisible="{Binding IsLoading}" DockPanel.Dock="Top">
      <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8" Margin="0,40">
        <ic:SymbolIcon Symbol="ArrowSync" IconVariant="Regular" FontSize="32"
                       Foreground="{DynamicResource FontDimBrush}"/>
        <TextBlock Text="Loading..." Classes="emptyHint"/>
      </StackPanel>
    </Panel>

    <!-- ========== 空状态 ========== -->
    <Panel IsVisible="{Binding IsEmpty}" DockPanel.Dock="Top">
      <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8" Margin="0,40">
        <ic:SymbolIcon Symbol="Search" IconVariant="Regular" FontSize="32"
                       Foreground="{DynamicResource FontDimBrush}"/>
        <TextBlock Text="No assets found" Classes="emptyTitle"/>
        <TextBlock Text="Try adjusting your search filters" Classes="emptyHint"/>
      </StackPanel>
    </Panel>

    <!-- ========== 素材网格 ========== -->
    <ScrollViewer>
      <ItemsControl ItemsSource="{Binding Assets}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal" ItemWidth="360" ItemHeight="110"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="models:AssetLibItem">
            <Border Classes="listItem" Margin="4" Padding="8"
                    Background="{DynamicResource DarkColor2}"
                    CornerRadius="4" Cursor="Hand">
              <Border.ContextMenu>
                <ContextMenu>
                  <MenuItem Header="Open in Browser"
                            Command="{Binding $parent[ItemsControl].((vm:AssetLibPageViewModel)DataContext).OpenAssetInBrowserCommand}"
                            CommandParameter="{Binding}">
                    <MenuItem.Icon>
                      <ic:SymbolIcon Symbol="Globe" IconVariant="Regular" FontSize="16"/>
                    </MenuItem.Icon>
                  </MenuItem>
                </ContextMenu>
              </Border.ContextMenu>

              <Grid ColumnDefinitions="64,*">
                <!-- 图标区域 -->
                <Border Grid.Column="0" Width="64" Height="64"
                        CornerRadius="4" ClipToBounds="True"
                        Background="{DynamicResource DarkColor3}">
                  <Panel>
                    <!-- 默认图标 -->
                    <ic:SymbolIcon Symbol="Apps" IconVariant="Regular" FontSize="28"
                                   Foreground="{DynamicResource FontDimBrush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <!-- 远程图标 (异步加载) -->
                    <Image Source="{Binding IconUrl}"
                           Stretch="UniformToFill"
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Panel>
                </Border>

                <!-- 信息区域 -->
                <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center" Spacing="2">
                  <TextBlock Text="{Binding Title}" FontWeight="SemiBold" FontSize="13"
                             TextTrimming="CharacterEllipsis" MaxLines="1"
                             Foreground="{DynamicResource AccentBrush}"/>
                  <TextBlock Text="{Binding Category}" FontSize="11"
                             Foreground="{DynamicResource FontDimBrush}"/>
                  <TextBlock Text="{Binding Author}" FontSize="11"
                             Foreground="{DynamicResource FontDimBrush}"/>
                  <TextBlock Text="{Binding Cost}" FontSize="11"
                             Foreground="{DynamicResource FontDimBrush}"/>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

  </DockPanel>

</UserControl>
