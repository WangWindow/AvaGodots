<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AvaGodots.ViewModels.Pages"
             xmlns:local="using:AvaGodots"
             xmlns:conv="using:AvaGodots.Converters"
             xmlns:models="using:AvaGodots.Models"
             xmlns:ic="using:FluentIcons.Avalonia"
             mc:Ignorable="d"
             x:Class="AvaGodots.Views.Pages.ProjectsPage"
             x:DataType="vm:ProjectsPageViewModel">

  <DockPanel>

    <!-- 顶部操作栏 -->
    <Border DockPanel.Dock="Top" Padding="8,6">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
          <Button Classes="action" Command="{Binding ShowNewProjectDialogCommand}">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <ic:SymbolIcon Symbol="Add" IconVariant="Regular" FontSize="14"/>
              <TextBlock Text="New" VerticalAlignment="Center" FontSize="13"/>
            </StackPanel>
          </Button>
          <Button Classes="action" Command="{Binding ShowImportDialogCommand}">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <ic:SymbolIcon Symbol="FolderOpen" IconVariant="Regular" FontSize="14"/>
              <TextBlock Text="Import" VerticalAlignment="Center" FontSize="13"/>
            </StackPanel>
          </Button>
          <Button Classes="action" Command="{Binding ScanDirectoryCommand}">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <ic:SymbolIcon Symbol="Search" IconVariant="Regular" FontSize="14"/>
              <TextBlock Text="Scan" VerticalAlignment="Center" FontSize="13"/>
            </StackPanel>
          </Button>
          <Button Classes="action" Command="{Binding RemoveMissingProjectsCommand}">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <ic:SymbolIcon Symbol="Delete" IconVariant="Regular" FontSize="14"/>
              <TextBlock Text="Remove Missing" VerticalAlignment="Center" FontSize="13"/>
            </StackPanel>
          </Button>
          <Button Classes="iconAction" Command="{Binding RefreshCommand}" ToolTip.Tip="Refresh">
            <ic:SymbolIcon Symbol="ArrowSync" IconVariant="Regular" FontSize="14"/>
          </Button>
        </StackPanel>

        <TextBox Grid.Column="1" Classes="searchBox"
                 Watermark="Filter Projects (tag:xxx)"
                 Text="{Binding SearchText, Mode=TwoWay}" Margin="8,0"/>

        <ComboBox Grid.Column="2" Classes="sortCombo"
                  SelectedIndex="{Binding SortIndex}" MinWidth="120">
          <ComboBoxItem Content="Last Edited"/>
          <ComboBoxItem Content="Name"/>
          <ComboBoxItem Content="Path"/>
          <ComboBoxItem Content="Tags"/>
        </ComboBox>
      </Grid>
    </Border>

    <!-- 主内容区 -->
    <Panel>
      <!-- 空状态 -->
      <StackPanel IsVisible="{Binding IsEmpty}"
                  HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
        <ic:SymbolIcon Symbol="DocumentBulletList" IconVariant="Regular" FontSize="48"
                       Foreground="{DynamicResource FontDimBrush}" HorizontalAlignment="Center"/>
        <TextBlock Text="No projects yet" FontSize="16" Foreground="{DynamicResource FontDimBrush}"
                   HorizontalAlignment="Center"/>
        <TextBlock Text="Click 'New' to create a project, 'Import' to add existing ones, or 'Scan' to find them."
                   FontSize="12" Foreground="{DynamicResource FontDimBrush}"
                   TextWrapping="Wrap" MaxWidth="400" HorizontalAlignment="Center" TextAlignment="Center"/>
      </StackPanel>

      <!-- 项目列表 -->
      <ScrollViewer IsVisible="{Binding !IsEmpty}"
                    VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <ItemsControl ItemsSource="{Binding FilteredProjects}" Margin="8,0,8,8">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="models:GodotProject">
              <Border Padding="8,6" CornerRadius="4" Margin="0,1"
                      Opacity="{Binding IsMissing, Converter={x:Static conv:BoolToOpacityConverter.Inverted}}"
                      Name="projectItem" Background="Transparent">
                <Border.Styles>
                  <Style Selector="Border#projectItem:pointerover">
                    <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                  </Style>
                  <Style Selector="Border#projectItem StackPanel.hoverActions">
                    <Setter Property="IsVisible" Value="False"/>
                    <Setter Property="Opacity" Value="0"/>
                  </Style>
                  <Style Selector="Border#projectItem:pointerover StackPanel.hoverActions">
                    <Setter Property="IsVisible" Value="True"/>
                    <Setter Property="Opacity" Value="1"/>
                  </Style>
                </Border.Styles>

                <Border.ContextMenu>
                  <ContextMenu>
                    <MenuItem Header="Edit" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).EditProjectCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Edit" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Run" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).RunProjectCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Play" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="Bind Editor..." Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowBindEditorDialogCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Link" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Manage Tags..." Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowTagDialogCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Tag" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="Duplicate..." Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowDuplicateDialogCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Copy" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Rename..." Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowRenameDialogCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Rename" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="Show in File Manager" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowInFileManagerCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="FolderOpen" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Copy Path" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).CopyPathCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="ClipboardPaste" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="Remove" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowDeleteConfirmCommand}" CommandParameter="{Binding}">
                      <MenuItem.Icon><ic:SymbolIcon Symbol="Delete" FontSize="14"/></MenuItem.Icon>
                    </MenuItem>
                  </ContextMenu>
                </Border.ContextMenu>

                <Grid ColumnDefinitions="Auto,Auto,*,Auto" DoubleTapped="OnProjectDoubleTapped">
                  <!-- 收藏 -->
                  <ToggleButton Grid.Column="0" Classes="favorite" IsChecked="{Binding IsFavorite}"
                                VerticalAlignment="Center" Margin="0,0,6,0"
                                Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ToggleFavoriteCommand}"
                                CommandParameter="{Binding}">
                    <Panel>
                      <ic:SymbolIcon Symbol="Star" IconVariant="Regular" FontSize="16" IsVisible="{Binding !IsFavorite}"/>
                      <ic:SymbolIcon Symbol="Star" IconVariant="Filled" FontSize="16" IsVisible="{Binding IsFavorite}"
                                     Foreground="{DynamicResource WarningBrush}"/>
                    </Panel>
                  </ToggleButton>

                  <!-- 图标 -->
                  <Border Grid.Column="1" Width="40" Height="40" Background="{DynamicResource DarkColor3}"
                          CornerRadius="4" Margin="0,0,10,0" VerticalAlignment="Center">
                    <ic:SymbolIcon Symbol="AppGeneric" IconVariant="Regular" FontSize="20"
                                   Foreground="{DynamicResource GodotBlueBrush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Border>

                  <!-- 信息 -->
                  <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="2">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
                      <Border Background="{DynamicResource TagBrush}" CornerRadius="3" Padding="6,1" VerticalAlignment="Center"
                              IsVisible="{Binding EditorName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="{Binding EditorName}" FontSize="10" Foreground="{DynamicResource AccentBrush}"/>
                      </Border>
                      <ic:SymbolIcon Symbol="Warning" IconVariant="Filled" FontSize="14" Foreground="{DynamicResource WarningBrush}"
                                     IsVisible="{Binding HasInvalidEditor}" VerticalAlignment="Center" ToolTip.Tip="Bound editor not found"/>
                      <ic:SymbolIcon Symbol="ErrorCircle" IconVariant="Filled" FontSize="14" Foreground="{DynamicResource ErrorBrush}"
                                     IsVisible="{Binding IsMissing}" VerticalAlignment="Center" ToolTip.Tip="Project files missing"/>
                      <ItemsControl ItemsSource="{Binding Features}">
                        <ItemsControl.ItemsPanel><ItemsPanelTemplate><StackPanel Orientation="Horizontal" Spacing="4"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate><DataTemplate><Border Background="#40556B" CornerRadius="3" Padding="4,1"><TextBlock Text="{Binding}" FontSize="10" Foreground="{DynamicResource FontBrush}"/></Border></DataTemplate></ItemsControl.ItemTemplate>
                      </ItemsControl>
                    </StackPanel>
                    <TextBlock Text="{Binding Path}" Classes="path" MaxWidth="700"/>
                    <ItemsControl ItemsSource="{Binding Tags}" IsVisible="{Binding Tags.Count}">
                      <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel Orientation="Horizontal"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                      <ItemsControl.ItemTemplate><DataTemplate>
                        <Button Classes="tagButton" Margin="0,2,4,0" Padding="6,2" Background="{DynamicResource TagBrush}" CornerRadius="3" BorderThickness="0" Cursor="Hand"
                                Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).FilterByTagCommand}" CommandParameter="{Binding}">
                          <TextBlock Text="{Binding}" FontSize="11" Foreground="{DynamicResource FontBrush}"/>
                        </Button>
                      </DataTemplate></ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </StackPanel>

                  <!-- hover 操作 -->
                  <StackPanel Grid.Column="3" Orientation="Horizontal" Classes="hoverActions" VerticalAlignment="Center" Spacing="2">
                    <Button Classes="iconAction" ToolTip.Tip="Edit" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).EditProjectCommand}" CommandParameter="{Binding}">
                      <ic:SymbolIcon Symbol="Edit" IconVariant="Regular" FontSize="16"/>
                    </Button>
                    <Button Classes="iconAction" ToolTip.Tip="Run" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).RunProjectCommand}" CommandParameter="{Binding}">
                      <ic:SymbolIcon Symbol="Play" IconVariant="Filled" FontSize="16" Foreground="{DynamicResource SuccessBrush}"/>
                    </Button>
                    <Button Classes="iconAction" ToolTip.Tip="Show in File Manager" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowInFileManagerCommand}" CommandParameter="{Binding}">
                      <ic:SymbolIcon Symbol="FolderOpen" IconVariant="Regular" FontSize="16"/>
                    </Button>
                    <Button Classes="iconAction" ToolTip.Tip="Remove" Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).ShowDeleteConfirmCommand}" CommandParameter="{Binding}">
                      <ic:SymbolIcon Symbol="Dismiss" IconVariant="Regular" FontSize="16"/>
                    </Button>
                  </StackPanel>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- 对话框 -->
      <Border Classes="dialogOverlay" IsVisible="{Binding IsNewProjectDialogVisible}" IsHitTestVisible="{Binding IsNewProjectDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="560" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="14" Width="500">
            <TextBlock Text="Create New Project" Classes="title" Margin="0,0,0,4"/>
            <StackPanel Spacing="4">
              <TextBlock Text="Project Name" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0" Text="{Binding NewProjectName, Mode=TwoWay}" Watermark="My New Project"/>
                <Button Grid.Column="1" Classes="iconAction" Margin="4,0,0,0" Command="{Binding RandomizeProjectNameCommand}" ToolTip.Tip="Randomize Name">
                  <ic:SymbolIcon Symbol="ArrowShuffle" IconVariant="Regular" FontSize="16"/>
                </Button>
              </Grid>
            </StackPanel>
            <StackPanel Spacing="4">
              <TextBlock Text="Project Path" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <Grid ColumnDefinitions="*,Auto,Auto">
                <TextBox Grid.Column="0" Text="{Binding NewProjectDirectory, Mode=TwoWay}" Watermark="/path/to/projects"/>
                <CheckBox Grid.Column="1" Content="Create Folder" IsChecked="{Binding CreateFolder}" Margin="8,0,4,0" VerticalAlignment="Center" FontSize="12"/>
                <Button Grid.Column="2" Classes="action" Content="Browse" Margin="4,0,0,0" Command="{Binding BrowseNewProjectDirectoryCommand}"/>
              </Grid>
              <TextBlock Text="{Binding ComputedProjectPath, StringFormat='→ {0}'}" FontSize="11" Foreground="{DynamicResource FontDimBrush}" TextTrimming="CharacterEllipsis" Margin="2,2,0,0"/>
            </StackPanel>
            <StackPanel Spacing="4">
              <TextBlock Text="Editor" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <ComboBox ItemsSource="{Binding AvailableEditors}" SelectedItem="{Binding NewProjectEditor}" HorizontalAlignment="Stretch">
                <ComboBox.ItemTemplate><DataTemplate DataType="models:GodotEditor"><TextBlock Text="{Binding Name}"/></DataTemplate></ComboBox.ItemTemplate>
              </ComboBox>
            </StackPanel>
            <StackPanel Spacing="4">
              <TextBlock Text="Renderer" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <ComboBox ItemsSource="{Binding RendererOptions}" SelectedItem="{Binding SelectedRenderer}" HorizontalAlignment="Stretch"/>
            </StackPanel>
            <StackPanel Spacing="4">
              <TextBlock Text="Version Control" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <ComboBox ItemsSource="{Binding VersionControlOptions}" SelectedItem="{Binding SelectedVersionControl}" HorizontalAlignment="Stretch"/>
            </StackPanel>
            <TextBlock Text="{Binding NewProjectStatus}" FontSize="12"
                       Foreground="{Binding NewProjectStatusIsValid, Converter={x:Static conv:StatusColorConverter.Instance}}"
                       IsVisible="{Binding NewProjectStatus, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" Margin="0,2,0,0"/>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,4,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelNewProjectCommand}"/>
              <Button Content="Create &amp; Edit" Classes="accent" Command="{Binding ConfirmNewProjectCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsImportDialogVisible}" IsHitTestVisible="{Binding IsImportDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="500" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="420">
            <TextBlock Text="Import Project" Classes="title" Margin="0,0,0,8"/>
            <StackPanel Spacing="4">
              <TextBlock Text="Project Path (project.godot)" FontSize="12"/>
              <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0" Text="{Binding ImportProjectPath, Mode=TwoWay}" Watermark="/path/to/project.godot"/>
                <Button Grid.Column="1" Classes="action" Content="Browse" Margin="4,0,0,0" Command="{Binding BrowseImportPathCommand}"/>
              </Grid>
            </StackPanel>
            <StackPanel Spacing="4">
              <TextBlock Text="Editor (optional)" FontSize="12"/>
              <ComboBox ItemsSource="{Binding AvailableEditors}" SelectedItem="{Binding ImportProjectEditor}" HorizontalAlignment="Stretch">
                <ComboBox.ItemTemplate><DataTemplate DataType="models:GodotEditor"><TextBlock Text="{Binding Name}"/></DataTemplate></ComboBox.ItemTemplate>
              </ComboBox>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelImportCommand}"/>
              <Button Content="Import &amp; Edit" Classes="action" Command="{Binding ConfirmImportAndEditCommand}"/>
              <Button Content="Import" Classes="accent" Command="{Binding ConfirmImportCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsDuplicateDialogVisible}" IsHitTestVisible="{Binding IsDuplicateDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="500" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="420">
            <TextBlock Text="Duplicate Project" Classes="title" Margin="0,0,0,8"/>
            <StackPanel Spacing="4"><TextBlock Text="New Project Name" FontSize="12"/><TextBox Text="{Binding DuplicateProjectName, Mode=TwoWay}"/></StackPanel>
            <StackPanel Spacing="4"><TextBlock Text="Target Directory" FontSize="12"/>
              <Grid ColumnDefinitions="*,Auto"><TextBox Grid.Column="0" Text="{Binding DuplicateProjectDirectory, Mode=TwoWay}"/>
                <Button Grid.Column="1" Classes="action" Content="Browse" Margin="4,0,0,0" Command="{Binding BrowseDuplicateDirectoryCommand}"/>
              </Grid>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelDuplicateCommand}"/>
              <Button Content="Duplicate" Classes="accent" Command="{Binding ConfirmDuplicateCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsRenameDialogVisible}" IsHitTestVisible="{Binding IsRenameDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="400" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="340">
            <TextBlock Text="Rename Project" Classes="title" Margin="0,0,0,8"/>
            <StackPanel Spacing="4"><TextBlock Text="New Name" FontSize="12"/><TextBox Text="{Binding RenameProjectName, Mode=TwoWay}"/></StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelRenameCommand}"/>
              <Button Content="Rename" Classes="accent" Command="{Binding ConfirmRenameCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsBindEditorDialogVisible}" IsHitTestVisible="{Binding IsBindEditorDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="450" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="380">
            <TextBlock Text="Bind Editor" Classes="title" Margin="0,0,0,8"/>
            <TextBlock Text="Select the Godot editor to use for this project:" FontSize="12" Foreground="{DynamicResource FontDimBrush}" TextWrapping="Wrap"/>
            <ComboBox ItemsSource="{Binding AvailableEditors}" SelectedItem="{Binding BindEditor}" HorizontalAlignment="Stretch">
              <ComboBox.ItemTemplate><DataTemplate DataType="models:GodotEditor"><StackPanel Orientation="Horizontal" Spacing="8"><TextBlock Text="{Binding Name}"/><TextBlock Text="{Binding VersionHint}" FontSize="11" Foreground="{DynamicResource FontDimBrush}"/></StackPanel></DataTemplate></ComboBox.ItemTemplate>
            </ComboBox>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelBindEditorCommand}"/>
              <Button Content="Bind" Classes="accent" Command="{Binding ConfirmBindEditorCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsTagDialogVisible}" IsHitTestVisible="{Binding IsTagDialogVisible}">
        <Border Classes="dialogContent" MaxWidth="500" MaxHeight="450" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="420">
            <TextBlock Text="Manage Tags" Classes="title" Margin="0,0,0,4"/>
            <StackPanel Spacing="4"><TextBlock Text="Assigned Tags" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <ItemsControl ItemsSource="{Binding AssignedTags}">
                <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel Orientation="Horizontal"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate><DataTemplate><Border Background="{DynamicResource AccentBrush}" CornerRadius="3" Padding="6,2" Margin="0,2,4,2">
                  <StackPanel Orientation="Horizontal" Spacing="4"><TextBlock Text="{Binding}" FontSize="11" Foreground="#1C2129"/>
                    <Button Padding="0" Background="Transparent" BorderThickness="0" MinWidth="14" MinHeight="14" Cursor="Hand"
                            Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).RemoveTagCommand}" CommandParameter="{Binding}">
                      <ic:SymbolIcon Symbol="Dismiss" FontSize="10" Foreground="#1C2129"/>
                    </Button></StackPanel></Border></DataTemplate></ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
            <Grid ColumnDefinitions="*,Auto" Margin="0,4,0,0">
              <TextBox Grid.Column="0" Text="{Binding NewTagText, Mode=TwoWay}" Watermark="new_tag" Classes="searchBox"/>
              <Button Grid.Column="1" Classes="action" Content="Add" Margin="4,0,0,0" Command="{Binding AddTagCommand}"/>
            </Grid>
            <StackPanel Spacing="4"><TextBlock Text="All Tags" FontSize="12" Foreground="{DynamicResource FontDimBrush}"/>
              <ItemsControl ItemsSource="{Binding AllKnownTags}">
                <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel Orientation="Horizontal"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate><DataTemplate><Button Padding="6,2" Margin="0,2,4,2" CornerRadius="3" Cursor="Hand" Background="{DynamicResource TagBrush}" BorderThickness="0"
                                                                 Command="{Binding $parent[ItemsControl].((vm:ProjectsPageViewModel)DataContext).AssignKnownTagCommand}" CommandParameter="{Binding}">
                  <TextBlock Text="{Binding}" FontSize="11" Foreground="{DynamicResource FontBrush}"/></Button></DataTemplate></ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelTagsCommand}"/>
              <Button Content="Save" Classes="accent" Command="{Binding ConfirmTagsCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsDeleteConfirmVisible}" IsHitTestVisible="{Binding IsDeleteConfirmVisible}">
        <Border Classes="dialogContent" MaxWidth="400" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="340">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <ic:SymbolIcon Symbol="Warning" IconVariant="Filled" FontSize="20" Foreground="{DynamicResource WarningBrush}"/>
              <TextBlock Text="Confirm Remove" Classes="title"/>
            </StackPanel>
            <TextBlock Text="{Binding DeleteConfirmMessage}" TextWrapping="Wrap" FontSize="13"/>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelDeleteCommand}"/>
              <Button Content="Remove" Classes="accent" Command="{Binding ConfirmDeleteCommand}" Background="{DynamicResource ErrorBrush}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <Border Classes="dialogOverlay" IsVisible="{Binding IsEditWarningVisible}" IsHitTestVisible="{Binding IsEditWarningVisible}">
        <Border Classes="dialogContent" MaxWidth="450" HorizontalAlignment="Center" VerticalAlignment="Center">
          <StackPanel Spacing="12" Width="380">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <ic:SymbolIcon Symbol="Info" IconVariant="Filled" FontSize="20" Foreground="{DynamicResource AccentBrush}"/>
              <TextBlock Text="Edit Project" Classes="title"/>
            </StackPanel>
            <TextBlock Text="You are about to open this project in the Godot editor. Make sure no other Godot instance is editing this project." TextWrapping="Wrap" FontSize="13"/>
            <CheckBox Content="Don't show this warning again" IsChecked="{Binding DontShowEditWarning}"/>
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
              <Button Content="Cancel" Classes="action" Command="{Binding CancelEditWarningCommand}"/>
              <Button Content="Edit" Classes="accent" Command="{Binding ConfirmEditWarningCommand}"/>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

    </Panel>
  </DockPanel>
</UserControl>
